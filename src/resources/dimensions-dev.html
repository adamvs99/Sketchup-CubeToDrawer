<!DOCTYPE html>
<html>
    <head>
        <title>Box to Drawer Parameters</title>
        <style>
            body { font-family: sans-serif; }
            button { padding: 10px 20px; }
            .center {
                text-align: center;
                border: 3px solid green;
            }
            .center_editable {
                text-align: center;
                width: 100px;
                font-weight: bold;
                #font-size: 1.15em;
            }
            .unit_noneditable {
                text-align: left;
                width: 30px;
                border: none;
                color: darkblue;
                #font-size: 1.15em;
                font-weight: bold;
            }
            .images {
                vertical-align: middle;
                horiz-align: center;
                height: 60%;
                margin: auto;
                margin-top: 10px;
                width: 60%;
                position: relative;
            }
            img { display: none; }
        </style>
    </head>
    <body>
    <h3 style="text-align: center;">Box to Drawer Parameters</h3>
    <div class="center">
        <h3>Thickness of drawer panels</h3>
        <p>
            <label for="sheet_thickness">Sheet Thickness:</label>
            <input class="center_editable" type="text" id="sheet_thickness" name="sheet_thickness" tabindex="1">
            <input class="unit_noneditable" type="text" id="sheet_units" name="sheet_units" readonly="readonly" tabindex="-1">
        </p>
        <p>
            <label for="dado_thickness">Dado Thickness:</label>
            <input class="center_editable" type="text" id="dado_thickness" name="dado_thickness" tabindex="2">
            <input class="unit_noneditable" type="text" id="dado_thickness_units" name="dado_thickness_units" readonly="readonly" tabindex="-1">
        </p>
        <p>
            <label for="dado_depth">Dado Depth:</label>
            <input class="center_editable" type="text" id="dado_depth" name="dado_depth" tabindex="3">
            <input class="unit_noneditable" type="text" id="dado_depth_units" name="dado_depth_units" readonly="readonly" tabindex="-1">
        </p>

        <p>
            <label for="hidden_dado">Hidden Dado:</label>
            <input class="center_editable" type="checkbox" id="hidden_dado" name="hidden_dado" value="hidden_dado" tabindex="4">
        </p>

        <p>
            <button onclick="sendDataToSketchUp()" id="update_button" tabindex="0">Update</button>
        </p>
    </div>
    <div class="images">
        <img id="sheet_thickness_img" alt="sheetThickness">
        <img id="dado_thickness_img" alt="dadoWidth">
        <img id="dado_depth_img" alt="dadoDepth">
    </div>
    <script>
        function sendDataToSketchUp() {
            var sheetThickness = document.getElementById('sheet_thickness').value;
            var dadoWidth = document.getElementById('dado_thickness').value;
            var dadoDepth = document.getElementById('dado_depth').value;

            sketchup.updateDimensionsValues(sheetThickness, dadoWidth, dadoDepth); // 'updateDialogValues' is a Ruby callback
        }
        
        // Live validation: turn text red on invalid input and disable Update
        // Helpers for live validation
        function isValidNumberStr(str) {
            if (str == null) return false;
            const s = String(str).trim();
            if (s === '') return false;
            const matches = /^[-+]?\d{0,3}\.{0,1}\d{0,4}$/.exec(s);
            if (matches == null) return false;
            if (matches[0] != s) return false;
            const n = parseFloat(s);
            return !Number.isNaN(n) && Number.isFinite(n) && n > 0.0001
        }

        function markValidity(inputEl, valid) {
            inputEl.style.color = valid ? 'black' : 'red';
        }

        function anyInvalid() {
            const ids = ['sheet_thickness', 'dado_thickness', 'dado_depth'];
            return ids.some(id => !isValidNumberStr(document.getElementById(id).value));
        }

        function updateButtonState() {
            document.getElementById('update_button').disabled = anyInvalid();
        }

        function inputNumberFormat(elementID) {
            const inputElement = document.getElementById(elementID);
            var inputValue = inputElement.value;
            inputValue = inputValue.trim();
            const numberValue = parseFloat(inputValue);
            if (!isNaN(numberValue)) {
                markValidity(inputElement, true);
                inputElement.value = numberValue.toFixed(2);
                document.getElementById("update_button").disabled = false;
            } else {
                markValidity(inputElement, false);
                document.getElementById("update_button").disabled = true;
                console.warn("Input is not a valid number.");
            }
        }

        ['sheet_thickness', 'dado_thickness', 'dado_depth'].forEach(id => {
            const el = document.getElementById(id);
            el.addEventListener('input', (event) => {
                const val = event.target.value
                const valid = isValidNumberStr(val);
                markValidity(event.target, valid);
                updateButtonState();
                console.log('Input value changed:', val)
            });
        });

        document.getElementById("hidden_dado").addEventListener('change', function() {
            sketchup.updateHiddenDado(this.checked)
        });
        document.addEventListener('DOMContentLoaded', function() {
            //sketchup.dom_loaded();
        });
    </script>
    </body>
</html>

